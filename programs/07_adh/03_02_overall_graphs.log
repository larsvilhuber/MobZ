
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
                                      College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

8-user Stata network perpetual license:
       Serial number:  501406244326
         Licensed to:  ECCO Cornell University
                       Ithaca, NY

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.

. do 03_02_overall_graphs.do 

. /*******************
> This makes graphs of
> distribution of results
> *******************/
. 
. include "../config.do"

. /*  config.do */
. 
. 
. 
. if ( "`c(hostname)'" == "ecco.vrdc.cornell.edu" ) {
. global root "/ssgprojects/project0002/MobZ.new"
. }

. 
. if ( "`c(username)'" == "vilhuber" ) {
. global root "/home/vilhuber/Workspace/git/larsvilhuber/MobZ"
. }

. 
. if ( "`c(hostname)'" == "some.server.at.census" ) {
. global root "/made/up/path/Mobz"
. }

. 
. /* check if the author creates a log file. If not, adjust the following code 
> fragment */
. 
. local c_date = c(current_date)

. local cdate = subinstr("`c_date'", " ", "_", .)

. local c_time = c(current_time)

. local ctime = subinstr("`c_time'", ":", "_", .)

. 
. // log using "${root}/logfile_`cdate'-`ctime'.log", replace text
. 
. /* It will provide some info about how and when the program was run */
. /* See https://www.stata.com/manuals13/pcreturn.pdf#pcreturn */
. local variant = cond(c(MP),"MP",cond(c(SE),"SE",c(flavor)) )  

. // alternatively, you could use 
. // local variant = cond(c(stata_version)>13,c(real_flavor),"NA")  
. 
. di "=== SYSTEM DIAGNOSTICS ==="
=== SYSTEM DIAGNOSTICS ===

. di "Stata version: `c(stata_version)'"
Stata version: 14.2

. di "Updated as of: `c(born_date)'"
Updated as of: 19 Dec 2017

. di "Variant:       `variant'"
Variant:       IC

. di "Processors:    `c(processors)'"
Processors:    1

. di "OS:            `c(os)' `c(osdtl)'"
OS:            Unix 

. di "Machine type:  `c(machine_type)'"
Machine type:  PC (64-bit x86-64)

. di "=========================="
==========================

. 
. 
. 
. 
. /* define relative libraries */
. 
. global paperdir "${root}/paper"

. global interwrk "${root}/data/interwrk"

. global raw "${root}/raw"

. global temp "${root}/temp"

. global outputs "${root}/data"

. global programs "${root}/programs"

. global outgraphs "${root}/figures"

. global logdir "${programs}/logs"

. 
. cap mkdir "$logdir"

. log using "${logdir}/logfile_`cdate'-`ctime'.log", replace text
(note: file /ssgprojects/project0002/MobZ.new/programs/logs/logfile_23_Aug_2020
> -11_09_31.log not found)
-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /ssgprojects/project0002/MobZ.new/programs/logs/logfile_23_Aug_202
> 0-11_09_31.log
  log type:  text
 opened on:  23 Aug 2020, 11:09:31

. cap mkdir "$temp"

. cap mkdir "${root}/data"

. cap mkdir "$interwrk"

. cap mkdir "$raw"

. cap mkdir "$outputs"

. 
. /* install any packages locally */
. capture mkdir "${programs}/ado"

. sysdir set PERSONAL "${programs}/ado/personal"

. sysdir set PLUS     "${programs}/ado/plus"

. sysdir set SITE     "${programs}/ado/site"

. sysdir
   STATA:  /usr/local/stata14/
    BASE:  /usr/local/stata14/ado/base/
    SITE:  /ssgprojects/project0002/MobZ.new/programs/ado/site/
    PLUS:  /ssgprojects/project0002/MobZ.new/programs/ado/plus/
PERSONAL:  /ssgprojects/project0002/MobZ.new/programs/ado/personal/
OLDPLACE:  ~/ado/

. 
. /* define data sources */
. 
. /* QCEW */
. /* data/working/mobz/qcew */
.     global qcewdata "${raw}/qcew"  

. /* /data/working/mobz/outputs */
.     global czonedata "$outputs"  

. 
. /* ADH */
.     global adhdata "${raw}/adh_data/Public Release Data/dta"

. /* CZONE */
.     global czonedata "${raw}/adh_data/"

. /* files provided separately by David Dorn */
.     global dorndata "${raw}/ddorn/"

. 
. /* CBP */
.     /* this is where the raw Stata versions of CBP data reside */
.    global cbpdata "/data/clean/cbp"

. 
. 
. 
. use "$interwrk/bootstrap_results.dta", clear

. sort iteration

. local true_est = beta_1990[1] 

. di "`true_est'"
-.8770237565040588

. local true_se = se_1990[1] 

. di "`true_se'"
.061982549726963

. local upper = `true_est'+(1.96*`true_se') 

. local lower = `true_est'-(1.96*`true_se')

. di "CONFIDENCE INTERVAL: [" %5.4f `lower' ", " %5.4f `upper' "]"
CONFIDENCE INTERVAL: [-0.9985, -0.7555]

. 
. #delimit ; 
delimiter now ;
. twoway (hist beta_1990 if iteration!=0)
>         (kdensity beta_1990 if iteration!=0)
>         (scatteri 0 `true_est' 40 `true_est', recast(line) lcolor(red) lwidth
> (thick) lpattern(dash)),
>        saving("$outgraphs/1990_distribution.gph", replace)
>        xtitle("Estimated Coefficient")
>        ytitle("Density")
>        title("Estimated Effect from Autor, Dorn and Hanson (2013)"
>        )
>        legend(off)
>               text(40 -.95 "Figure shows estimates of the" 
>                            "effect of growth in trade with"
>                            "China on manufacturing "
>                            "employment using 1000 "
>                            "realizations of commuting zones"              
>                     , box place(se)  just(left) 
>                         fcolor(gs15) bcolor(gs2) margin(vsmall))
>                     
>                 text(36.3 -.86 "Replicated Estimate"              
>                     , box place(ne) fcolor(white)  just(left) color(red) marg
> in(small))
>        ;
(file /ssgprojects/project0002/MobZ.new/figures/1990_distribution.gph saved)

.               graph export "$outgraphs/1990_distribution_SOLE.pdf", replace ;
(file /ssgprojects/project0002/MobZ.new/figures/1990_distribution_SOLE.pdf writ
> ten in PDF format)

.               twoway (hist beta_1990 if iteration!=0)
>         (kdensity beta_1990 if iteration!=0)
>         (scatteri 0 `true_est' 35 `true_est', recast(line) lcolor(red) lwidth
> (thick) lpattern(dash)),
>        saving("$outgraphs/1990_distribution.gph", replace)
>        xtitle("Estimated Coefficient")
>        ytitle("Density")
>        title("Estimated Effect from Autor, Dorn and Hanson (2013)"
>        )
>        legend(off)              
>        ;
(file /ssgprojects/project0002/MobZ.new/figures/1990_distribution.gph saved)

.               graph export "$outgraphs/1990_distribution.pdf", replace ;
(file /ssgprojects/project0002/MobZ.new/figures/1990_distribution.pdf written i
> n PDF format)

. sum tstat_1990 beta_1990 if iteration!=0,d;

                         tstat_1990
-------------------------------------------------------------
      Percentiles      Smallest
 1%    -14.63471      -15.15011
 5%    -14.37194      -14.90368
10%    -14.29106       -14.7557       Obs               1,000
25%    -14.16552      -14.71093       Sum of Wgt.       1,000

50%    -14.02208                      Mean          -14.02039
                        Largest       Std. Dev.      .2310207
75%    -13.88373      -13.27951
90%    -13.74053      -13.27256       Variance       .0533706
95%    -13.63809      -13.22423       Skewness      -.0521165
99%    -13.44871      -13.14433       Kurtosis        4.22761

                          beta_1990
-------------------------------------------------------------
      Percentiles      Smallest
 1%    -.9130646      -.9554853
 5%    -.8851918      -.9373388
10%    -.8789612      -.9323735       Obs               1,000
25%    -.8709962      -.9303596       Sum of Wgt.       1,000

50%    -.8620251                      Mean          -.8625637
                        Largest       Std. Dev.      .0148277
75%    -.8530612      -.8247573
90%    -.8451546      -.8195269       Variance       .0002199
95%    -.8411932      -.8158585       Skewness      -.8350247
99%    -.8288428      -.8108976       Kurtosis       6.817614

. centile tstat_1990, centile(2.5 97.5);

                                                       -- Binom. Interp. --
    Variable |       Obs  Percentile    Centile        [95% Conf. Interval]
-------------+-------------------------------------------------------------
  tstat_1990 |     1,001        2.5   -14.48305       -14.56318    -14.4446
             |                 97.5   -13.52317       -13.55367   -13.50097

. preserve ;

. sum tstat_1990 if iteration==0 ;

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  tstat_1990 |          1   -14.14953           .  -14.14953  -14.14953

.  local actual_tstat = r(mean);

. keep if iteration!=0 ;
(1 observation deleted)

. sort tstat_1990 ;

. di " The 2.5th and 97.5th percentiles of the t-distibution statistic are" %6.
> 4f tstat_1990[25] "  and   " %6.4f tstat_1990[975] ;
 The 2.5th and 97.5th percentiles of the t-distibution statistic are-14.4831  a
> nd   -13.5278

. local lower_bound = tstat_1990[25];

. local upper_bound = tstat_1990[975];

. restore ;

. twoway (hist tstat_1990 if iteration!=0)
>         (kdensity tstat_1990 if iteration!=0)
>         (scatteri 0 `lower_bound' 2 `lower_bound', recast(line) lcolor(gs12) 
> lwidth(thick) lpattern(dash))
>         (scatteri 0 `upper_bound' 2 `upper_bound', recast(line) lcolor(gs12) 
> lwidth(thick) lpattern(dash))
>         (scatteri 0 `actual_tstat' 2 `actual_tstat', recast(line) lcolor(blue
> ) lwidth(thick) lpattern(dash)),
>        saving("$outgraphs/1990_tdistribution.gph", replace)
>        xtitle("T-statistic")
>        ytitle("Density")
>       /* xline(`true_est',lstyle(foreground) lpattern(dash) lcolor(red))*/
>        title("Distribution of T-Statistic, 1990")
>        legend(off)
>        ;
(file /ssgprojects/project0002/MobZ.new/figures/1990_tdistribution.gph saved)

.               graph export "$outgraphs/1990_tstat_distribution.pdf", replace 
> ;
(file /ssgprojects/project0002/MobZ.new/figures/1990_tstat_distribution.pdf wri
> tten in PDF format)

. twoway (hist beta_2000 if iteration!=0)
> (kdensity beta_2000 if iteration!=0),
>        saving("$outgraphs/2000_distribution.gph", replace)
>        xtitle("Coefficient")
>        ytitle("Density")
>        title("Distribution of Estimated Effect, 1990")
>        legend(off)
>        xline(`true_est');
(note: file /ssgprojects/project0002/MobZ.new/figures/2000_distribution.gph not
>  found)
(file /ssgprojects/project0002/MobZ.new/figures/2000_distribution.gph saved)

. graph export "$outgraphs/2000_distribution.pdf", replace ;
(file /ssgprojects/project0002/MobZ.new/figures/2000_distribution.pdf written i
> n PDF format)

.        twoway (hist beta_all if iteration!=0)
>         (kdensity beta_all if iteration!=0),
>        saving("$outgraphs/all_distribution.gph", replace)
>        xtitle("Coefficient")
>        ytitle("Density")
>        title("Distribution of Estimated Effect, 1990")
>        legend(off)
>        xline(`true_est');
(note: file /ssgprojects/project0002/MobZ.new/figures/all_distribution.gph not 
> found)
(file /ssgprojects/project0002/MobZ.new/figures/all_distribution.gph saved)

.        graph export "$outgraphs/all_distribution.pdf", replace ;
(file /ssgprojects/project0002/MobZ.new/figures/all_distribution.pdf written in
>  PDF format)

. 
end of do-file
