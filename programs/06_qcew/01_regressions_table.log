
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

8-user 8-core Stata network perpetual license:
       Serial number:  501406244326
         Licensed to:  ECCO Cornell University
                       Ithaca, NY

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.

. do 01_regressions_table.do 

. /**********************
> This is the do-file that creates
> the tables for Table 2 of the paper
> 
> Four regressions:
> Weighted/unweighted
> 
> TS1996 commuting zones and our replicated
> commuting zones
>         
> ***************************/
. 
. include "../config.do"

. /*  config.do */
. 
. 
. 
. if ( "`c(hostname)'" == "ecco.vrdc.cornell.edu" ) {
. global root "/ssgprojects/project0002/MobZ.new"
. }

. 
. if ( "`c(username)'" == "vilhuber" ) {
. global root "/home/vilhuber/Workspace/git/larsvilhuber/MobZ"
. }

. 
. if ( "`c(hostname)'" == "some.server.at.census" ) {
. global root "/made/up/path/Mobz"
. }

. 
. /* check if the author creates a log file. If not, adjust the following code 
> fragment */
. 
. local c_date = c(current_date)

. local cdate = subinstr("`c_date'", " ", "_", .)

. local c_time = c(current_time)

. local ctime = subinstr("`c_time'", ":", "_", .)

. 
. // log using "${root}/logfile_`cdate'-`ctime'.log", replace text
. 
. /* It will provide some info about how and when the program was run */
. /* See https://www.stata.com/manuals13/pcreturn.pdf#pcreturn */
. local variant = cond(c(MP),"MP",cond(c(SE),"SE",c(flavor)) )  

. // alternatively, you could use 
. // local variant = cond(c(stata_version)>13,c(real_flavor),"NA")  
. 
. di "=== SYSTEM DIAGNOSTICS ==="
=== SYSTEM DIAGNOSTICS ===

. di "Stata version: `c(stata_version)'"
Stata version: 14.2

. di "Updated as of: `c(born_date)'"
Updated as of: 19 Dec 2017

. di "Variant:       `variant'"
Variant:       MP

. di "Processors:    `c(processors)'"
Processors:    8

. di "OS:            `c(os)' `c(osdtl)'"
OS:            Unix 

. di "Machine type:  `c(machine_type)'"
Machine type:  PC (64-bit x86-64)

. di "=========================="
==========================

. 
. 
. 
. 
. /* define relative libraries */
. 
. global paperdir "${root}/paper"

. global interwrk "${root}/data/interwrk"

. global raw "${root}/raw"

. global temp "${root}/temp"

. global outputs "${root}/data"

. global programs "${root}/programs"

. global outgraphs "${root}/figures"

. global logdir "${programs}/logs"

. 
. cap mkdir "$logdir"

. log using "${logdir}/logfile_`cdate'-`ctime'.log", replace text
(note: file /ssgprojects/project0002/MobZ.new/programs/logs/logfile_10_Jul_2020
> -14_20_35.log not found)
-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /ssgprojects/project0002/MobZ.new/programs/logs/logfile_10_Jul_202
> 0-14_20_35.log
  log type:  text
 opened on:  10 Jul 2020, 14:20:35

. cap mkdir "$temp"

. cap mkdir "${root}/data"

. cap mkdir "$interwrk"

. cap mkdir "$raw"

. cap mkdir "$outputs"

. 
. /* install any packages locally */
. capture mkdir "${programs}/ado"

. sysdir set PERSONAL "${programs}/ado/personal"

. sysdir set PLUS     "${programs}/ado/plus"

. sysdir set SITE     "${programs}/ado/site"

. sysdir
   STATA:  /usr/local/stata14/
    BASE:  /usr/local/stata14/ado/base/
    SITE:  /ssgprojects/project0002/MobZ.new/programs/ado/site/
    PLUS:  /ssgprojects/project0002/MobZ.new/programs/ado/plus/
PERSONAL:  /ssgprojects/project0002/MobZ.new/programs/ado/personal/
OLDPLACE:  ~/ado/

. 
. /* define data sources */
. 
. /* QCEW */
. /* data/working/mobz/qcew */
.     global qcewdata "${raw}/qcew"  

. /* /data/working/mobz/outputs */
.     global czonedata "$outputs"  

. 
. /* ADH */
.     global adhdata "${raw}/adh_data/Public Release Data/dta"

. /* CZONE */
.     global czonedata "${raw}/adh_data/"

. 
. /* CBP */
.     /* this is where the raw Stata versions of CBP data reside */
.    global cbpdata "/data/clean/cbp"

. 
. 
. 
. local czonedataset = "${outputs}/clusters_cutoff_jtw1990.dta"

. //local qcewdata = "${outputs}/qcew_county.dta"
. global qcewfile = "${outputs}/qcew_county.dta"

. global czone_iteration = "${interwrk}/czones_cutoff.dta"

. 
. #delimit ; 
delimiter now ;
. /*********************************
> First get the two czone datasets ready
> **********************************/
> set more off;

.     use "$outputs/bootclusters_jtw1990_moe_new.dta", clear;

.        keep fips clustername ;

.     egen czone = group(clustername) ;

.         tempfile czone_rep ;

.     sort fips ;

.     save `czone_rep', replace ;
(note: file /tmp/St02474.000001 not found)
file /tmp/St02474.000001 saved

.     //import delimited /data/working/mobz/geo/cz90.csv , clear ;
>     use "${interwrk}/czlma903", clear;

.     //tostring countyfipscode, gen(fips) ;
>     //replace fips = "0" + fips if length(fips) == 4 ;
>     rename countyfipscode fips;

.     egen czone = group(cz90) ;

.     keep fips czone ;

.         sort fips ;

.     tempfile czone_ts ;

.     save `czone_ts', replace;
(note: file /tmp/St02474.000002 not found)
file /tmp/St02474.000002 saved

. /**********************************
>  industry data
> **********************************/
> /* create shell here */
> 
> use $qcewfile, clear;

. //destring naics2, force replace;
> rename naics2 naics2char;

. egen naics2 = group(naics2char);

. compress fips;
  (0 bytes saved)

. tempfile qcewdata;

. save `qcewdata';
file /tmp/St02474.000003 saved

.   use `qcewdata', clear;

.   //  destring naics2, force replace ;
>  collapse (first) fips, by(naics2 year) ;

.  keep naics2 year ;

.  tempfile shell;

.  save `shell', replace;
(note: file /tmp/St02474.000004 not found)
file /tmp/St02474.000004 saved

.   /* create industry-year data here */
>  use `qcewdata', clear;

.  // destring naics2, force replace ; 
>  collapse (sum) EMP_jt = annual_avg_emplvl, by(naics2 year) ;

. sort naics2 year ;

.  xtset naics2 year ;
       panel variable:  naics2 (strongly balanced)
        time variable:  year, 1990 to 2016
                delta:  1 unit

. gen delta_emp_jt = log(EMP_jt) - log(L.EMP_jt) ;
(19 missing values generated)

. tempfile industry_by_year ;

. save `industry_by_year' , replace ;
(note: file /tmp/St02474.000005 not found)
file /tmp/St02474.000005 saved

. /********************************
> First, regressions with TS1990 
> *********************************/
> 
> use `czone_ts', clear ;

.    compress fips;
  (0 bytes saved)

.    desc fips;

              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
fips            str5    %9s                   County FIPS Code

.    save $czone_iteration, replace;
file /ssgprojects/project0002/MobZ.new/data/interwrk/czones_cutoff.dta saved

.  collapse (first) fips, by( czone) ;

.       cross using `shell' ;

.       tempfile shell2 ;

.       save `shell2', replace ;
(note: file /tmp/St02474.000006 not found)
file /tmp/St02474.000006 saved

.             include "$programs/06_qcew/zz_bartik_merge.do" ;

. #delimit ; 
delimiter now ;
. /*******************************************
> 
> globals set above - this will be "include"-d
> 
> ********************************************/
> 
>  /* important tempfiles:
> 
> masterdata - data to which things will get merged
> $czone_iteration - the czone definition being used right now
>    (already sorted by FIPS)
> qcewdata - sorted by fips
> industry_by_year - sorted by naics2 year (employment growth);
> shell - a naics-year-czone dataset for merging into ;
> 
> */
>     
> use `qcewdata', clear;

. //destring naics2, force replace;  
> sort fips ;

.  merge fips using $czone_iteration ;
(note: you are using old merge syntax; see [D] merge for new syntax)
variable fips does not uniquely identify observations in the master data

. drop _merge ;

. tempfile mergefile;

. save `mergefile', replace;
(note: file /tmp/St02474.000007 not found)
file /tmp/St02474.000007 saved

. /************** BASE YEAR ***********************/
> bys naics2 czone: egen L_ij1990 = sum(annual_avg_emplvl*(year==1990)) ;

. bys czone: egen L_1990 = sum(annual_avg_emplvl*(year==1990)) ;

. gen gamma_ij1990 = L_ij1990 / L_1990 ;
(705 missing values generated)

. collapse (first) gamma_ij1990, by(czone naics2) ;

. sort czone naics2;

. tempfile base_year ;

. save `base_year', replace;
(note: file /tmp/St02474.000008 not found)
file /tmp/St02474.000008 saved

. /************** merging into bartik  *****************/
> 
> use `shell2', clear ;

. sort czone naics2 ;

. merge czone naics2 using `base_year' ;
(note: you are using old merge syntax; see [D] merge for new syntax)
variables czone naics2 do not uniquely identify observations in the master
    data

. drop _merge ;

. sort naics2 year ;

. merge naics2 year using `industry_by_year', keep(delta_emp_jt) ;
(note: you are using old merge syntax; see [D] merge for new syntax)
variables naics2 year do not uniquely identify observations in the master
    data

. bys czone year: egen bartik_it = sum(delta_emp_jt*gamma_ij1990) ;

. collapse (first) bartik_it, by(czone year) ;

. keep czone year bartik_it ;

. tempfile bartik ;

. save `bartik', replace;
(note: file /tmp/St02474.000009 not found)
file /tmp/St02474.000009 saved

. /************** NOW, COLLAPSE EARNINGS TO CZONE **********/
> 
> use "$interwrk/bea_table30.dta", clear;

.   sort fips ;

. merge fips using $czone_iteration ;
(note: you are using old merge syntax; see [D] merge for new syntax)
variable fips does not uniquely identify observations in the master data

. collapse (sum) uireceipt , by(czone year) ;

.  gen log_uireceipt = log(uireceipt) ;
(22 missing values generated)

. sort czone year ;

. merge czone year using `bartik' ;
(note: you are using old merge syntax; see [D] merge for new syntax)

. drop _merge ;

.  tempfile mergedfile ;

. /* then will merge this outside this file, to */

.       xtset czone year;
       panel variable:  czone (unbalanced)
        time variable:  year, 1990 to 2016
                delta:  1 unit

.  sum bartik_it, d;

                      (first) bartik_it
-------------------------------------------------------------
      Percentiles      Smallest
 1%     -.077061      -.1842037
 5%    -.0339482      -.1144908
10%    -.0210692       -.107453       Obs              20,013
25%            0      -.1049875       Sum of Wgt.      20,013

50%     .0141103                      Mean           .0068019
                        Largest       Std. Dev.      .0222472
75%     .0208122        .110543
90%     .0253943        .113257       Variance       .0004949
95%     .0278811       .1151739       Skewness      -1.700117
99%     .0355138       .1908425       Kurtosis       7.633696

. local sd_ts = r(sd);

.       areg log_uireceipt L.bartik_it i.year, absorb(czone) cluster(czone) ;

Linear regression, absorbing indicators         Number of obs     =     18,500
                                                F(  25,    739)   =    1145.28
                                                Prob > F          =     0.0000
                                                R-squared         =     0.9839
                                                Adj R-squared     =     0.9832
                                                Root MSE          =     0.2484

                                (Std. Err. adjusted for 740 clusters in czone)
------------------------------------------------------------------------------
             |               Robust
log_uirece~t |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   bartik_it |
         L1. |  -7.016348   .9660145    -7.26   0.000    -8.912807   -5.119888
             |
        year |
       1992  |   .1521647   .0253366     6.01   0.000     .1024245    .2019049
       1993  |   .6720364   .0088606    75.85   0.000     .6546414    .6894314
       1994  |    .691007   .0179066    38.59   0.000     .6558532    .7261608
       1995  |   .4394638   .0273018    16.10   0.000     .3858654    .4930622
       1996  |   .3876147   .0265176    14.62   0.000      .335556    .4396734
       1997  |   .4163864   .0219142    19.00   0.000     .3733649     .459408
       1998  |   .3713962    .024764    15.00   0.000     .3227801    .4200124
       1999  |   .3559373   .0231255    15.39   0.000     .3105377    .4013369
       2000  |   .3653184   .0207966    17.57   0.000     .3244909    .4061458
       2001  |   .3444325   .0174757    19.71   0.000     .3101245    .3787405
       2002  |   .7289096   .0232697    31.32   0.000      .683227    .7745922
       2003  |   .8332346    .026485    31.46   0.000     .7812399    .8852294
       2004  |   .9697563    .018648    52.00   0.000     .9331469    1.006366
       2005  |    .776855   .0161193    48.19   0.000     .7452098    .8085001
       2006  |   .6636397   .0204065    32.52   0.000      .623578    .7037013
       2007  |   .5979545   .0186824    32.01   0.000     .5612776    .6346314
       2008  |   .6124258   .0161407    37.94   0.000     .5807387    .6441129
       2009  |   .9019018   .0181095    49.80   0.000     .8663496    .9374539
       2010  |   1.415649   .0667975    21.19   0.000     1.284513    1.546784
       2011  |   1.802314   .0240401    74.97   0.000     1.755119    1.849509
       2012  |   1.780657   .0222521    80.02   0.000     1.736972    1.824342
       2013  |   1.571756   .0254472    61.77   0.000     1.521799    1.621714
       2014  |   1.239713   .0203346    60.97   0.000     1.199793    1.279634
       2015  |   .7618372   .0247271    30.81   0.000     .7132934     .810381
             |
       _cons |   8.501321   .0098239   865.37   0.000     8.482035    8.520607
-------------+----------------------------------------------------------------
       czone |   absorbed                                     (740 categories)

.                  local beta_ts = _b[L.bartik_it] ;

.                  local se_ts = _se[L.bartik_it] ;

.                  local tstat_ts = _b[L.bartik_it]/_se[L.bartik_it] ;

. /***
>  then a weighted regression here
> ***/
> 
> 
> /*******************************
> Second regressions with FKV1990
> *******************************/
> use `czone_rep' , clear ;

.      compress fips;
  variable fips was str10 now str5
  (15,700 bytes saved)

.     desc fips;

              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
fips            str5    %9s                   

.     save $czone_iteration, replace;
file /ssgprojects/project0002/MobZ.new/data/interwrk/czones_cutoff.dta saved

.  collapse (first) fips, by( czone) ;

.       cross using `shell' ;

.       tempfile shell2 ;

.       save `shell2', replace ;
(note: file /tmp/St02474.00000b not found)
file /tmp/St02474.00000b saved

.             include "$programs/06_qcew/zz_bartik_merge.do" ;

. #delimit ; 
delimiter now ;
. /*******************************************
> 
> globals set above - this will be "include"-d
> 
> ********************************************/
> 
>  /* important tempfiles:
> 
> masterdata - data to which things will get merged
> $czone_iteration - the czone definition being used right now
>    (already sorted by FIPS)
> qcewdata - sorted by fips
> industry_by_year - sorted by naics2 year (employment growth);
> shell - a naics-year-czone dataset for merging into ;
> 
> */
>     
> use `qcewdata', clear;

. //destring naics2, force replace;  
> sort fips ;

.  merge fips using $czone_iteration ;
(note: you are using old merge syntax; see [D] merge for new syntax)
variable fips does not uniquely identify observations in the master data

. drop _merge ;

. tempfile mergefile;

. save `mergefile', replace;
(note: file /tmp/St02474.00000c not found)
file /tmp/St02474.00000c saved

. /************** BASE YEAR ***********************/
> bys naics2 czone: egen L_ij1990 = sum(annual_avg_emplvl*(year==1990)) ;

. bys czone: egen L_1990 = sum(annual_avg_emplvl*(year==1990)) ;

. gen gamma_ij1990 = L_ij1990 / L_1990 ;

. collapse (first) gamma_ij1990, by(czone naics2) ;

. sort czone naics2;

. tempfile base_year ;

. save `base_year', replace;
(note: file /tmp/St02474.00000d not found)
file /tmp/St02474.00000d saved

. /************** merging into bartik  *****************/
> 
> use `shell2', clear ;

. sort czone naics2 ;

. merge czone naics2 using `base_year' ;
(note: you are using old merge syntax; see [D] merge for new syntax)
variables czone naics2 do not uniquely identify observations in the master
    data

. drop _merge ;

. sort naics2 year ;

. merge naics2 year using `industry_by_year', keep(delta_emp_jt) ;
(note: you are using old merge syntax; see [D] merge for new syntax)
variables naics2 year do not uniquely identify observations in the master
    data

. bys czone year: egen bartik_it = sum(delta_emp_jt*gamma_ij1990) ;

. collapse (first) bartik_it, by(czone year) ;

. keep czone year bartik_it ;

. tempfile bartik ;

. save `bartik', replace;
(note: file /tmp/St02474.00000e not found)
file /tmp/St02474.00000e saved

. /************** NOW, COLLAPSE EARNINGS TO CZONE **********/
> 
> use "$interwrk/bea_table30.dta", clear;

.   sort fips ;

. merge fips using $czone_iteration ;
(note: you are using old merge syntax; see [D] merge for new syntax)
variable fips does not uniquely identify observations in the master data

. collapse (sum) uireceipt , by(czone year) ;

.  gen log_uireceipt = log(uireceipt) ;
(28 missing values generated)

. sort czone year ;

. merge czone year using `bartik' ;
(note: you are using old merge syntax; see [D] merge for new syntax)

. drop _merge ;

.  tempfile mergedfile ;

. /* then will merge this outside this file, to */

.             xtset czone year;
       panel variable:  czone (unbalanced)
        time variable:  year, 1990 to 2016
                delta:  1 unit

.  sum bartik_it, d;

                      (first) bartik_it
-------------------------------------------------------------
      Percentiles      Smallest
 1%    -.0788482      -.1191017
 5%    -.0353507      -.1086787
10%    -.0218642      -.1082915       Obs              20,390
25%    -.0009752      -.1047922       Sum of Wgt.      20,390

50%     .0138523                      Mean           .0062613
                        Largest       Std. Dev.      .0224982
75%     .0206193       .0974502
90%     .0251998       .1171211       Variance       .0005062
95%     .0277301       .1183259       Skewness      -1.781264
99%     .0337249       .1306634       Kurtosis       7.229036

. local sd_fkv = r(sd);

.       areg log_uireceipt L.bartik_it i.year, absorb(czone) cluster(czone) ;

Linear regression, absorbing indicators         Number of obs     =     18,700
                                                F(  25,    747)   =    1580.72
                                                Prob > F          =     0.0000
                                                R-squared         =     0.9782
                                                Adj R-squared     =     0.9773
                                                Root MSE          =     0.2298

                                (Std. Err. adjusted for 748 clusters in czone)
------------------------------------------------------------------------------
             |               Robust
log_uirece~t |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   bartik_it |
         L1. |  -8.395262   .7419061   -11.32   0.000    -9.851731   -6.938793
             |
        year |
       1992  |   .1320137    .020145     6.55   0.000     .0924662    .1715612
       1993  |   .6759529   .0080927    83.53   0.000     .6600657    .6918401
       1994  |   .6937496   .0145249    47.76   0.000     .6652352     .722264
       1995  |   .4355229   .0217686    20.01   0.000      .392788    .4782577
       1996  |   .3790523   .0210867    17.98   0.000      .337656    .4204485
       1997  |   .3940059    .017706    22.25   0.000     .3592464    .4287654
       1998  |   .3579972   .0201018    17.81   0.000     .3185345    .3974599
       1999  |   .3339426   .0191969    17.40   0.000     .2962563     .371629
       2000  |    .332034   .0178442    18.61   0.000     .2970032    .3670648
       2001  |   .3373569   .0152739    22.09   0.000     .3073721    .3673418
       2002  |   .7768492   .0183008    42.45   0.000      .740922    .8127764
       2003  |   .8435528   .0214876    39.26   0.000     .8013696     .885736
       2004  |   .9847043   .0149507    65.86   0.000     .9553538    1.014055
       2005  |   .8145054   .0151849    53.64   0.000     .7846951    .8443156
       2006  |   .7242877   .0181238    39.96   0.000     .6887082    .7598673
       2007  |   .6628373    .017297    38.32   0.000     .6288808    .6967939
       2008  |   .6648899   .0150518    44.17   0.000     .6353409    .6944388
       2009  |   .9539298   .0164364    58.04   0.000     .9216627    .9861969
       2010  |    1.38519   .0529429    26.16   0.000     1.281256    1.489125
       2011  |   1.848445   .0203411    90.87   0.000     1.808512    1.888377
       2012  |   1.871314   .0206459    90.64   0.000     1.830783    1.911844
       2013  |   1.653204   .0229655    71.99   0.000      1.60812    1.698289
       2014  |   1.294621   .0189748    68.23   0.000     1.257371    1.331871
       2015  |   .7876828   .0227559    34.61   0.000     .7430098    .8323558
             |
       _cons |   8.946483   .0091368   979.17   0.000     8.928546    8.964419
-------------+----------------------------------------------------------------
       czone |   absorbed                                     (748 categories)

.                  local beta_fkv = _b[L.bartik_it] ;

.                  local se_fkv = _se[L.bartik_it] ;

.                  local tstat_fkv = _b[L.bartik_it]/_se[L.bartik_it] ;

. di "***********************************************************";
***********************************************************

. di "*********************** RESULTS ***************************";
*********************** RESULTS ***************************

. di "BETAS:  TS   " %6.4f `beta_ts' "     FKV  " %6.4f `beta_fkv' ;
BETAS:  TS   -7.0163     FKV  -8.3953

. di "SES:  TS   " %6.4f `se_ts' "     FKV  " %6.4f `se_fkv' ;
SES:  TS   0.9660     FKV  0.7419

. di "TSTAT:  TS   " %6.4f `tstat_ts' "     FKV  " %6.4f `tstat_fkv' ;
TSTAT:  TS   -7.2632     FKV  -11.3158

. di "SD Bartik:     " %6.4f `sd_ts' "    FKV   " %6.4f `sd_fkv' ;
SD Bartik:     0.0222    FKV   0.0225

. di "***********************************************************";
***********************************************************

. 
end of do-file
