
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
                                      College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

8-user Stata network perpetual license:
       Serial number:  501406244326
         Licensed to:  ECCO Cornell University
                       Ithaca, NY

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.

. do 00_bea_readin.do 

. 
. include "../config.do"

. /*  config.do */
. 
. 
. 
. if ( "`c(hostname)'" == "ecco.vrdc.cornell.edu" ) {
. global root "/ssgprojects/project0002/MobZ.new"
. }

. 
. if ( "`c(username)'" == "vilhuber" ) {
. global root "/home/vilhuber/Workspace/git/larsvilhuber/MobZ"
. }

. 
. if ( "`c(hostname)'" == "some.server.at.census" ) {
. global root "/made/up/path/Mobz"
. }

. 
. /* check if the author creates a log file. If not, adjust the following code 
> fragment */
. 
. local c_date = c(current_date)

. local cdate = subinstr("`c_date'", " ", "_", .)

. local c_time = c(current_time)

. local ctime = subinstr("`c_time'", ":", "_", .)

. 
. // log using "${root}/logfile_`cdate'-`ctime'.log", replace text
. 
. /* It will provide some info about how and when the program was run */
. /* See https://www.stata.com/manuals13/pcreturn.pdf#pcreturn */
. local variant = cond(c(MP),"MP",cond(c(SE),"SE",c(flavor)) )  

. // alternatively, you could use 
. // local variant = cond(c(stata_version)>13,c(real_flavor),"NA")  
. 
. di "=== SYSTEM DIAGNOSTICS ==="
=== SYSTEM DIAGNOSTICS ===

. di "Stata version: `c(stata_version)'"
Stata version: 14.2

. di "Updated as of: `c(born_date)'"
Updated as of: 19 Dec 2017

. di "Variant:       `variant'"
Variant:       IC

. di "Processors:    `c(processors)'"
Processors:    1

. di "OS:            `c(os)' `c(osdtl)'"
OS:            Unix 

. di "Machine type:  `c(machine_type)'"
Machine type:  PC (64-bit x86-64)

. di "=========================="
==========================

. 
. 
. 
. 
. /* define relative libraries */
. 
. global paperdir "${root}/paper"

. global interwrk "${root}/data/interwrk"

. global raw "${root}/raw"

. global temp "${root}/temp"

. global outputs "${root}/data"

. global programs "${root}/programs"

. global outgraphs "${root}/figures"

. global logdir "${programs}/logs"

. 
. cap mkdir "$logdir"

. log using "${logdir}/logfile_`cdate'-`ctime'.log", replace text
(note: file /ssgprojects/project0002/MobZ.new/programs/logs/logfile__3_Jul_2020
> -17_14_35.log not found)
-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /ssgprojects/project0002/MobZ.new/programs/logs/logfile__3_Jul_202
> 0-17_14_35.log
  log type:  text
 opened on:   3 Jul 2020, 17:14:35

. cap mkdir "$temp"

. cap mkdir "${root}/data"

. cap mkdir "$interwrk"

. cap mkdir "$raw"

. cap mkdir "$outputs"

. 
. /* install any packages locally */
. capture mkdir "${programs}/ado"

. sysdir set PERSONAL "${programs}/ado/personal"

. sysdir set PLUS     "${programs}/ado/plus"

. sysdir set SITE     "${programs}/ado/site"

. sysdir
   STATA:  /usr/local/stata14/
    BASE:  /usr/local/stata14/ado/base/
    SITE:  /ssgprojects/project0002/MobZ.new/programs/ado/site/
    PLUS:  /ssgprojects/project0002/MobZ.new/programs/ado/plus/
PERSONAL:  /ssgprojects/project0002/MobZ.new/programs/ado/personal/
OLDPLACE:  ~/ado/

. 
. /* define data sources */
. 
. /* QCEW */
. /* data/working/mobz/qcew */
.     global qcewdata "${raw}/qcew"  

. /* /data/working/mobz/outputs */
.     global czonedata "$outputs"  

. 
. /* ADH */
.     global adhdata "${raw}/adh_data/Public Release Data/dta"

. /* CZONE */
.     global czonedata "${raw}/adh_data/"

. 
. /* CBP */
.     /* this is where the raw Stata versions of CBP data reside */
.    global cbpdata "/data/clean/cbp"

. 
. 
. 
. * import delimited "$raw/bea_table30.csv", clear ; 
. /* the last three lines contain unwanted footnotes */
. /* We use shell script here to remove them */
. /* On windows, do this manually! */
. 
. tempfile a

. ! head -n -3 "$raw/CAINC30__ALL_AREAS_1969_2018.csv" > `a'


. //insheet using "${raw}/jtw2009_2013.csv", names
. insheet using "`a'", names
(58 vars, 99,138 obs)

. 
. #delimit ; 
delimiter now ;
. keep if linecode == 70 ;
(95,940 observations deleted)

.  destring geofips, replace;
geofips: all characters numeric; replaced as long

. keep if floor(geofips/1000) != geofips/1000 ;
(60 observations deleted)

. forvalues i = 29/54 { ;
  2.         local yr = `i'+1961 ;
  3.         rename v`i' uireceipt`yr' ;
  4. };

. keep geofips uireceipt* ;

. reshape long uireceipt ,i(geofips) j(year) ;
(note: j = 1990 1991 1992 1993 1994 1995 1996 1997 1998 1999 2000 2001 2002 200
> 3 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                     3138   ->   81588
Number of variables                  27   ->       3
j variable (26 values)                    ->   year
xij variables:
uireceipt1990 uireceipt1991 ... uireceipt2015->uireceipt
-----------------------------------------------------------------------------

. rename geofips fips ;

.  destring uireceipt, force replace ;
uireceipt: contains nonnumeric characters; replaced as long
(710 missing values generated)

.  tostring fips, replace;
fips was long now str5

.  replace fips = "0"+fips if length(fips) == 4 ;
(8,840 real changes made)

.  save "$interwrk/bea_table30.dta", replace;
file /ssgprojects/project0002/MobZ.new/data/interwrk/bea_table30.dta saved

.   outsheet using "$interwrk/bea_table30.csv", replace noquote comma;

. /* create summary stats */
> sum;

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        fips |          0
        year |     81,588      2002.5    7.500046       1990       2015
   uireceipt |     80,878    14492.21    67104.55          0    5327267

. codebook;

-------------------------------------------------------------------------------
fips                                                                    GeoFIPS
-------------------------------------------------------------------------------

                  type:  string (str5)

         unique values:  3,138                    missing "":  0/81,588

              examples:  "17019"
                         "26003"
                         "36063"
                         "47119"

-------------------------------------------------------------------------------
year                                                                (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (int)

                 range:  [1990,2015]                  units:  1
         unique values:  26                       missing .:  0/81,588

                  mean:    2002.5
              std. dev:   7.50005

           percentiles:        10%       25%       50%       75%       90%
                              1992      1996    2002.5      2009      2013

-------------------------------------------------------------------------------
uireceipt                                                           (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (long)

                 range:  [0,5327267]                  units:  1
         unique values:  23,139                   missing .:  710/81,588

                  mean:   14492.2
              std. dev:   67104.5

           percentiles:        10%       25%       50%       75%       90%
                               304       901      2511      7571     24988

. 
end of do-file
