
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
                                      College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

8-user Stata network perpetual license:
       Serial number:  501406244326
         Licensed to:  ECCO Cornell University
                       Ithaca, NY

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.

. do 05_01_flows.do 

. /* This program runs the bootstrap stuff */
. /* Author: Andrew Foote */
. 
. include "config.do"

. /*  config.do */
. 
. 
. 
. if ( "`c(hostname)'" == "ecco.vrdc.cornell.edu" ) {
. global root "/ssgprojects/project0002/MobZ.new"
. }

. 
. if ( "`c(username)'" == "vilhuber" ) {
. global root "/home/vilhuber/Workspace/git/larsvilhuber/MobZ"
. }

. 
. if ( "`c(hostname)'" == "some.server.at.census" ) {
. global root "/made/up/path/Mobz"
. }

. 
. /* check if the author creates a log file. If not, adjust the following code 
> fragment */
. 
. local c_date = c(current_date)

. local cdate = subinstr("`c_date'", " ", "_", .)

. local c_time = c(current_time)

. local ctime = subinstr("`c_time'", ":", "_", .)

. 
. // log using "${root}/logfile_`cdate'-`ctime'.log", replace text
. 
. /* It will provide some info about how and when the program was run */
. /* See https://www.stata.com/manuals13/pcreturn.pdf#pcreturn */
. local variant = cond(c(MP),"MP",cond(c(SE),"SE",c(flavor)) )  

. // alternatively, you could use 
. // local variant = cond(c(stata_version)>13,c(real_flavor),"NA")  
. 
. di "=== SYSTEM DIAGNOSTICS ==="
=== SYSTEM DIAGNOSTICS ===

. di "Stata version: `c(stata_version)'"
Stata version: 14.2

. di "Updated as of: `c(born_date)'"
Updated as of: 19 Dec 2017

. di "Variant:       `variant'"
Variant:       IC

. di "Processors:    `c(processors)'"
Processors:    1

. di "OS:            `c(os)' `c(osdtl)'"
OS:            Unix 

. di "Machine type:  `c(machine_type)'"
Machine type:  PC (64-bit x86-64)

. di "=========================="
==========================

. 
. 
. 
. 
. /* define relative libraries */
. 
. global paperdir "${root}/paper"

. global interwrk "${root}/data/interwrk"

. global raw "${root}/raw"

. global temp "${root}/temp"

. global outputs "${root}/data"

. global programs "${root}/programs"

. global outgraphs "${root}/figures"

. global logdir "${programs}/logs"

. 
. cap mkdir "$logdir"

. log using "${logdir}/logfile_`cdate'-`ctime'.log", replace text
(note: file /ssgprojects/project0002/MobZ.new/programs/logs/logfile_22_Jun_2020
> -17_19_03.log not found)
-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /ssgprojects/project0002/MobZ.new/programs/logs/logfile_22_Jun_202
> 0-17_19_03.log
  log type:  text
 opened on:  22 Jun 2020, 17:19:03

. cap mkdir "$temp"

. cap mkdir "${root}/data"

. cap mkdir "$interwrk"

. cap mkdir "$raw"

. cap mkdir "$outputs"

. 
. /* install any packages locally */
. capture mkdir "${programs}/ado"

. sysdir set PERSONAL "${programs}/ado/personal"

. sysdir set PLUS     "${programs}/ado/plus"

. sysdir set SITE     "${programs}/ado/site"

. sysdir
   STATA:  /usr/local/stata14/
    BASE:  /usr/local/stata14/ado/base/
    SITE:  /ssgprojects/project0002/MobZ.new/programs/ado/site/
    PLUS:  /ssgprojects/project0002/MobZ.new/programs/ado/plus/
PERSONAL:  /ssgprojects/project0002/MobZ.new/programs/ado/personal/
OLDPLACE:  ~/ado/

. 
. /* define data sources */
. 
. /* QCEW */
. /* data/working/mobz/qcew */
.     global qcewdata "${raw}/qcew"  

. /* /data/working/mobz/outputs */
.     global czonedata "$outputs"  

. 
. 
. /* the last three lines contain unwanted footnotes */
. /* We use shell script here to remove them */
. /* On windows, do this manually! */
. 
. tempfile a

. ! head -n -3 "${raw}/jtw2009_2013.csv" > `a'


. //insheet using "${raw}/jtw2009_2013.csv", names
. insheet using "`a'", names
(6 vars, 137,492 obs)

. 
. save "$interwrk/jtw2009_2013", replace
file /ssgprojects/project0002/MobZ.new/data/interwrk/jtw2009_2013.dta saved

. 
. gen ratio = moe/flow

. 
. sum flow, d

                            flow
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            2              1
10%            4              1       Obs             137,492
25%            8              1       Sum of Wgt.     137,492

50%           17                      Mean           1024.377
                        Largest       Std. Dev.      19353.24
75%           53        1665369
90%          314        1790482       Variance       3.75e+08
95%         1234        2057967       Skewness       100.1357
99%        15022        4050061       Kurtosis       16425.89

. 
. foreach x in 50 90 95 99 {
  2.         local pct`x' = r(p`x')
  3. }

. 
. sum ratio if flow<=`pct50', d

                            ratio
-------------------------------------------------------------
      Percentiles      Smallest
 1%     .8333333       .3076923
 5%     1.071429       .3571429
10%     1.230769       .4615385       Obs              69,721
25%     1.454545       .4705882       Sum of Wgt.      69,721

50%     1.571429                      Mean           1.620341
                        Largest       Std. Dev.      .4883182
75%          1.7           15.5
90%            2       16.33333       Variance       .2384547
95%     2.166667             22       Skewness       8.562702
99%            3             25       Kurtosis       215.2002

. 
. sum ratio if flow> `pct50' & flow <= `pct90',d 

                            ratio
-------------------------------------------------------------
      Percentiles      Smallest
 1%     .2820513       .1025641
 5%           .4       .1476793
10%       .48125       .1484716       Obs              54,035
25%      .691358       .1517241       Sum of Wgt.      54,035

50%            1                      Mean           1.009267
                        Largest       Std. Dev.      .3907276
75%     1.303571       2.388889
90%       1.5625       2.423077       Variance       .1526681
95%     1.615385       2.428571       Skewness       .0661973
99%     1.722222       3.409091       Kurtosis       2.082733

. sum ratio if flow> `pct90' & flow <= `pct95',d 

                            ratio
-------------------------------------------------------------
      Percentiles      Smallest
 1%      .098249       .0549828
 5%     .1432432       .0612245
10%     .1728155       .0616071       Obs               6,862
25%     .2157191       .0641574       Sum of Wgt.       6,862

50%     .2718843                      Mean           .2793708
                        Largest       Std. Dev.      .0910145
75%     .3349282       .7067901
90%     .3954802       .7223881       Variance       .0082836
95%      .435514       .8469657       Skewness       .6908073
99%     .5361111       1.147493       Kurtosis       5.011821

. sum ratio if flow> `pct95' & flow <= `pct99',d 

                            ratio
-------------------------------------------------------------
      Percentiles      Smallest
 1%     .0326464       .0197777
 5%     .0453625       .0219536
10%     .0538444       .0230022       Obs               5,500
25%     .0727845       .0238023       Sum of Wgt.       5,500

50%     .1078933                      Mean           .1139662
                        Largest       Std. Dev.      .0503894
75%      .149981       .3293503
90%     .1848962       .3429303       Variance       .0025391
95%     .2022596       .3709677       Skewness       .5664962
99%     .2394102       .3845708       Kurtosis       2.901955

. sum ratio if flow> `pct99',d 

                            ratio
-------------------------------------------------------------
      Percentiles      Smallest
 1%     .0055715       .0025679
 5%     .0093454       .0032318
10%     .0130659       .0036806       Obs               1,374
25%     .0203014       .0039955       Sum of Wgt.       1,374

50%     .0299852                      Mean           .0307233
                        Largest       Std. Dev.      .0136044
75%     .0404062       .0690616
90%     .0486531       .0733382       Variance       .0001851
95%     .0541851       .0767126       Skewness       .3027273
99%     .0629067       .0875627       Kurtosis       2.677152

. #delimit ; 
delimiter now ;
. twoway (kdensity ratio if flow <= `pct50' & ratio<10) 
>                 (kdensity ratio if flow> `pct50' & flow<=`pct90')
>                 (kdensity ratio if flow> `pct90' & flow<=`pct95')
>                 (kdensity ratio if flow> `pct95' & flow<=`pct99'),
>                 legend(label(1 "First Cat") label(2 "Second Cat")
>                                 label(3 "Third Cat") label(4 "Fourth Cat"))
>                 xtitle("Ratio")
>                 ytitle("Density");

. graph save "$outgraphs/figure05a_temp.gph", replace;
(file /ssgprojects/project0002/MobZ.new/figures/figure05a_temp.gph saved)

. graph export "$outgraphs/figure05a_temp.pdf", replace;
(file /ssgprojects/project0002/MobZ.new/figures/figure05a_temp.pdf written in P
> DF format)

. #delimit cr
delimiter now cr
. 
. gen flowsize=  . 
(137,492 missing values generated)

.         replace flowsize = 1 if flow<= `pct50'
(69,721 real changes made)

.         replace flowsize = 2 if flow> `pct50' & flow <= `pct90'
(54,035 real changes made)

.         replace flowsize = 3 if flow> `pct90' & flow <= `pct95'
(6,862 real changes made)

.         replace flowsize = 4 if flow> `pct95' & flow <= `pct99'
(5,500 real changes made)

.         replace flowsize = 5 if flow> `pct99'
(1,374 real changes made)

. 
. bys flowsize: egen sd_ratio = sd(ratio)

. bys flowsize: egen mean_ratio = mean(ratio)

. 
. collapse (first) sd_ratio mean_ratio, by(flowsize)

. 
. export delimited using "$interwrk/flow_moe_ratios.csv", replace
file /ssgprojects/project0002/MobZ.new/data/interwrk/flow_moe_ratios.csv saved

. 
. /* do other stuff here */
. 
. tempfile ratios 

. save `ratios', replace
(note: file /tmp/St19052.000002 not found)
file /tmp/St19052.000002 saved

. 
. 
. 
. 
. use  "${outputs}/flows1990.dta", clear 

. rename jobsflow flows

. sum flows, d

                            flows
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              0
 5%            2              0
10%            2              0       Obs             216,659
25%            6              0       Sum of Wgt.     216,659

50%            9                      Mean           530.8164
                        Largest       Std. Dev.      13478.62
75%           27        1187997
90%          136        1294782       Variance       1.82e+08
95%          454        2147598       Skewness       150.1649
99%         6714        3872310       Kurtosis       35805.89

. 
. 
. foreach x in 50 90 95 99 {
  2.         local pct`x' = r(p`x')
  3. }

. 
. gen flowsize=  . 
(216,659 missing values generated)

.         replace flowsize = 1 if flows<= `pct50'
(109,855 real changes made)

.         replace flowsize = 2 if flows> `pct50' & flows <= `pct90'
(85,144 real changes made)

.         replace flowsize = 3 if flows> `pct90' & flows <= `pct95'
(10,837 real changes made)

.         replace flowsize = 4 if flows> `pct95' & flows <= `pct99'
(8,657 real changes made)

.         replace flowsize = 5 if flows> `pct99'
(2,166 real changes made)

. 
. sort flowsize 

. merge flowsize using `ratios'
(note: you are using old merge syntax; see [D] merge for new syntax)
variable flowsize does not uniquely identify observations in the master data

. drop _merge

. tab flowsize, m 

   flowsize |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |    109,855       50.70       50.70
          2 |     85,144       39.30       90.00
          3 |     10,837        5.00       95.00
          4 |      8,657        4.00       99.00
          5 |      2,166        1.00      100.00
------------+-----------------------------------
      Total |    216,659      100.00

. /*************************************
> ONE TIME DRAW FROM RATIO DISTRIBUTION
> **************************************/
. gen ratiodraw = rnormal(mean_ratio,sd_ratio)

. 
.  sum ratiodraw

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratiodraw |    216,659    1.237165    .6223046  -.6483829   3.733539

. /* sometimes is negative: redraw until positive */
. 
. while (r(min)<0) {
  2.         replace ratiodraw = rnormal(mean_ratio,sd_ratio) if ratiodraw < 0 
  3.          sum ratiodraw 
  4. }
(597 real changes made)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratiodraw |    216,659    1.239717    .6194479  -.2774651   3.733539
(5 real changes made)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratiodraw |    216,659    1.239741    .6194153   .0000241   3.733539

. 
. /* create file for downstream processing */
. 
. gen moe = flows*ratiodraw

. format moe ratiodraw mean_ratio sd_ratio %15.5f

. outfile using "$interwrk/jtw1990_moe.csv", comma replace noquote

. sort work_cty home_cty 

. 
. list in 150/200

     +--------------------------------------------------------------+
150. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01009 |     4 |    01089 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.24997           |             4.99989           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
151. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01009 |   153 |    01095 |        3 |  0.09101 |  0.27937 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.29383           |            44.95657           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
152. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01009 |     2 |    01097 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.30739           |             2.61478           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
153. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01009 |    17 |    01103 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.17159           |            19.91707           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
154. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01009 |     5 |    01113 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.54636           |             7.73178           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
155. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01009 |   247 |    01115 |        3 |  0.09101 |  0.27937 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.39255           |            96.95975           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
156. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01009 |    31 |    01117 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.36542           |            42.32816           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
157. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01009 |   149 |    01127 |        3 |  0.09101 |  0.27937 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.27670           |            41.22903           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
158. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01009 |     3 |    01133 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.02799           |             3.08398           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
159. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01009 |    10 |    37043 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.95546           |             9.55459           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
160. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01009 |    10 |    47165 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.26173           |            12.61733           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
161. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |     5 |    01001 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            2.21179           |            11.05897           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
162. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |   116 |    01005 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.39697           |            46.04816           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
163. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |  2829 |    01011 |        4 |  0.05039 |  0.11397 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.06306           |           178.39601           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
164. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |     2 |    01021 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.35291           |             2.70582           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
165. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |     8 |    01039 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            2.12999           |            17.03991           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
166. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |    10 |    01041 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.84184           |             8.41842           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
167. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |    17 |    01051 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.78048           |            13.26817           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
168. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |    12 |    01073 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.88405           |            10.60863           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
169. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |     8 |    01081 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.73323           |            13.86588           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
170. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |    10 |    01085 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.40549           |            14.05492           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
171. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |   150 |    01087 |        3 |  0.09101 |  0.27937 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.27803           |            41.70507           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
172. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |   156 |    01101 |        3 |  0.09101 |  0.27937 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.34274           |            53.46691           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
173. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |     8 |    01103 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.33371           |            10.66970           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
174. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |   107 |    01109 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.60084           |           171.28981           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
175. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |    55 |    01113 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.36671           |            75.16913           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
176. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |     9 |    01117 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            2.34655           |            21.11892           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
177. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |     7 |    01123 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.69381           |            11.85668           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
178. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |    21 |    01127 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.32378           |            27.79945           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
179. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |     7 |    13045 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.35432           |             9.48025           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
180. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |     9 |    47103 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.02295           |             9.20652           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
181. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01011 |     2 |    48209 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.49107           |             2.98215           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
182. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |     4 |    01003 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.32991           |             1.31962           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
183. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |     7 |    01005 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.63970           |            11.47787           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
184. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |  5774 |    01013 |        4 |  0.05039 |  0.11397 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.13851           |           799.74469           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
185. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |     6 |    01023 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.79837           |            10.79022           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
186. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |     6 |    01031 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.55040           |             9.30238           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
187. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |   221 |    01035 |        3 |  0.09101 |  0.27937 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.33736           |            74.55731           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
188. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |     2 |    01037 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.45776           |             0.91553           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
189. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |    66 |    01039 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.54846           |            36.19829           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
190. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |   206 |    01041 |        3 |  0.09101 |  0.27937 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.22460           |            46.26765           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
191. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |    37 |    01047 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.12007           |            41.44266           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
192. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |    21 |    01051 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.31141           |             6.53968           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
193. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |    14 |    01053 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.61352           |             8.58932           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
194. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |     9 |    01069 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.09051           |             9.81463           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
195. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |   173 |    01085 |        3 |  0.09101 |  0.27937 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.36943           |            63.91079           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
196. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |     6 |    01089 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.25230           |             7.51378           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
197. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |     5 |    01093 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.37299           |             6.86495           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
198. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |     7 |    01097 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.72827           |             5.09786           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
199. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |     8 |    01099 |        1 |  0.48832 |  1.62034 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            1.65701           |            13.25604           |
     +--------------------------------------------------------------+

     +--------------------------------------------------------------+
200. | work_cty | flows | home_cty | flowsize | sd_ratio | mean_r~o |
     |    01013 |    87 |    01101 |        2 |  0.39073 |  1.00927 |
     |--------------------------------------------------------------|
     |           ratiod~w           |                 moe           |
     |            0.76640           |            66.67703           |
     +--------------------------------------------------------------+

. 
. save "$interwrk/jtw1990_moe.dta", replace
file /ssgprojects/project0002/MobZ.new/data/interwrk/jtw1990_moe.dta saved

. 
. /* create different file for downstream */
. gen ratio_hat = moe/flows 
(15 missing values generated)

. bys flowsize: egen average_ratio = mean(ratio_hat) 

. bys flowsize: egen std_ratio = sd(ratio_hat) 

. 
. bys flowsize: sum average_ratio mean_ratio 

-------------------------------------------------------------------------------
-> flowsize = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
average_ra~o |    109,855    1.620319           0   1.620319   1.620319
  mean_ratio |    109,855    1.620341           0   1.620341   1.620341

-------------------------------------------------------------------------------
-> flowsize = 2

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
average_ra~o |     85,144    1.016134           0   1.016134   1.016134
  mean_ratio |     85,144    1.009267           0   1.009267   1.009267

-------------------------------------------------------------------------------
-> flowsize = 3

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
average_ra~o |     10,837    .2786642           0   .2786642   .2786642
  mean_ratio |     10,837    .2793708           0   .2793708   .2793708

-------------------------------------------------------------------------------
-> flowsize = 4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
average_ra~o |      8,657    .1151125           0   .1151125   .1151125
  mean_ratio |      8,657    .1139662           0   .1139662   .1139662

-------------------------------------------------------------------------------
-> flowsize = 5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
average_ra~o |      2,166    .0312897           0   .0312897   .0312897
  mean_ratio |      2,166    .0307233           0   .0307233   .0307233


. bys flowsize: sum std_ratio sd_ratio 

-------------------------------------------------------------------------------
-> flowsize = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   std_ratio |    109,855     .488334           0    .488334    .488334
    sd_ratio |    109,855    .4883182           0   .4883182   .4883182

-------------------------------------------------------------------------------
-> flowsize = 2

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   std_ratio |     85,144    .3836749           0   .3836749   .3836749
    sd_ratio |     85,144    .3907276           0   .3907276   .3907276

-------------------------------------------------------------------------------
-> flowsize = 3

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   std_ratio |     10,837    .0897732           0   .0897732   .0897732
    sd_ratio |     10,837    .0910145           0   .0910145   .0910145

-------------------------------------------------------------------------------
-> flowsize = 4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   std_ratio |      8,657    .0483566           0   .0483566   .0483566
    sd_ratio |      8,657    .0503894           0   .0503894   .0503894

-------------------------------------------------------------------------------
-> flowsize = 5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   std_ratio |      2,166    .0132663           0   .0132663   .0132663
    sd_ratio |      2,166    .0136044           0   .0136044   .0136044


. 
. drop average_ratio std_ratio ratio_hat ratiodraw

. rename flows jobsflow

. 
. outsheet using "${outputs}/jtw1990_flows.csv", replace comma noquote

. 
. 
end of do-file
